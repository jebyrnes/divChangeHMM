head(chil)
randF <- function(x) return(as.factor(paste(x$era, x$nest1, x$nest2, sep="_")))
chil$rand1 <- randF(chil)
unique(chil$rand1)
### quick model
mod1 <- lmer(size1mm ~ era*nest1 + (era|rand1),
data = chil)
;mod1
anova(mod1)
mod1 <- lm(size1mm ~ era*nest1,
data = chil)
anova(mod1)
# create new factor with tidal heights
factorList <- unique(chil$nest1)
factorList
unique(chil$tideHTm)
factorList2 <- c("2.7m", "3.8m", "5.9m", "7.3m")
factorList2
tideHT <- plyr::mapvalues(chil$nest1, from = factorList, to = factorList2)
# reorder the levels
tideHT2 <- factor(tideHT, levels = c("7.3m", "5.9m", "3.8m", "2.7m"))
chil$tideHT <- tideHT2
############################################
### plot
# histogram
ggplot(chil,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
facet_grid(tideHT ~ era, scales = "free_y") +
xlab("Size (mm)") + ylab("Frequency (%)")
# density
ggplot(chil,  aes(x = size1mm)) +
geom_density(aes(color = era)) +
facet_wrap(~ tideHT, scales = "fixed", nrow = 4) +
xlab("Size (mm)") + ylab("Probability density") +
theme(legend.justification = c(1, 1), legend.position = c(0.97, 0.23),
legend.text = element_text(size = 6), legend.title = element_text(size = 6)) +
ggtitle("Littorina keenae")
ggsave("./figs/sbs_fig2.pdf", width = 3.5, height = 7)
# histogram
ggplot(chil,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
facet_grid(tideHT ~ era, scales = "free_y") +
xlab("Size (mm)") + ylab("Frequency (%)")
source("./R/summarizeData_150204.R")
dens
dens_stats <- summarySE(data = dens, measurevar = dens_m2,
groupvars = c("nest1", "era"))
dens_stats <- summarySE(data = dens, measurevar = "dens_m2",
groupvars = c("nest1", "era"))
dens_stats
dens
dens_stats
summarySE(data = dens, measurevar = "dens_m2", groupvars = "era")
summary(chil)
past_D <- chil %>% filter(era == "past" & nest1 == "zoneD")
past_A <- chil %>% filter(era == "past" & nest1 == "zoneA")
past_B <- chil %>% filter(era == "past" & nest1 == "zoneB")
past_C <- chil %>% filter(era == "past" & nest1 == "zoneC")
present_A <- chil %>% filter(era == "present" & nest1 == "zoneA")
present_B <- chil %>% filter(era == "present" & nest1 == "zoneB")
present_C <- chil %>% filter(era == "present" & nest1 == "zoneC")
present_D <- chil %>% filter(era == "present" & nest1 == "zoneD")
ULClabel <- theme(plot.title = element_text(hjust = -0.08, vjust = 1,
size = rel(1)))
no_legend <- theme(legend.position = "none")
ggplot(past_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n1947\nn = 650",
x = 18, y = 0.16, size = 2.2)
ggplot(chil,  aes(x = size1mm)) +
geom_density(aes(color = era)) +
facet_wrap(~ tideHT, scales = "fixed", nrow = 4) +
xlab("Size (mm)") + ylab("Probability density") +
theme(legend.justification = c(1, 1), legend.position = c(0.97, 0.23),
legend.text = element_text(size = 6), legend.title = element_text(size = 6)) +
ggtitle("Littorina keenae")
ggplot(past_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "Littorina keenae\n1947\nn = 650",
x = 18, y = 0.16, size = 2.2)
dens_stats
ggplot(past_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 196",
x = 18, y = 0.16, size = 2.2)
plot_pastA <- ggplot(past_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 196\nNo. per m2 = 84.4",
x = 18, y = 0.16, size = 2.2)
ggplot(past_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 196\nNo. per m2 = 84.4",
x = 18, y = 0.16, size = 2.2)
ggplot(past_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.2)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "3.8m\n1947\nn = 239\nNo. per m2 = 102.9",
x = 18, y = 0.16, size = 2.2)
ggplot(past_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray")
ggplot(past_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.25)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "3.8m\n1947\nn = 239\nNo. per m2 = 102.9",
x = 18, y = 0.16, size = 2.2)
dens_stats
ggplot(past_C,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.25)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "5.9m\n1947\nn = 215\nNo. per m2 = 92.6",
x = 18, y = 0.16, size = 2.2)
ggplot(past_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.25)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 32\nNo. per m2 = 13.8",
x = 18, y = 0.16, size = 2.2)
ggplot(past_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray")
ggplot(past_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 32\nNo. per m2 = 13.8",
x = 18, y = 0.16, size = 2.2)
plot_presentA <- ggplot(present_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 196\nNo. per m2 = 84.4",
x = 18, y = 0.16, size = 2.2)
plot_presentB <- ggplot(present_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "3.8m\n1947\nn = 239\nNo. per m2 = 102.9",
x = 18, y = 0.16, size = 2.2)
plot_presentC <- ggplot(present_C,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "5.9m\n1947\nn = 215\nNo. per m2 = 92.6",
x = 18, y = 0.16, size = 2.2)
plot_presentD <- ggplot(present_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 32\nNo. per m2 = 13.8",
x = 18, y = 0.16, size = 2.2)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentA, plot_presentB, plot_presentC, plot_presentD,
cols = 1)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentA, plot_presentB, plot_presentC, plot_presentD,
cols = 1)
plot_pastD <- ggplot(past_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 32\nNo. per m2 = 13.8",
x = 18, y = 0.16, size = 2.2)
ULClabel <- theme(plot.title = element_text(hjust = -0.08, vjust = 1,
size = rel(1)))
no_legend <- theme(legend.position = "none")
dens_stats
plot_pastA <- ggplot(past_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 196\nNo. per m2 = 84.4",
x = 18, y = 0.16, size = 2.2)
plot_pastB <- ggplot(past_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "3.8m\n1947\nn = 239\nNo. per m2 = 102.9",
x = 18, y = 0.16, size = 2.2)
plot_pastC <- ggplot(past_C,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "5.9m\n1947\nn = 215\nNo. per m2 = 92.6",
x = 18, y = 0.16, size = 2.2)
plot_pastD <- ggplot(past_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 32\nNo. per m2 = 13.8",
x = 18, y = 0.16, size = 2.2)
# present
plot_presentA <- ggplot(present_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 196\nNo. per m2 = 84.4",
x = 18, y = 0.16, size = 2.2)
plot_presentB <- ggplot(present_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "3.8m\n1947\nn = 239\nNo. per m2 = 102.9",
x = 18, y = 0.16, size = 2.2)
plot_presentC <- ggplot(present_C,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "5.9m\n1947\nn = 215\nNo. per m2 = 92.6",
x = 18, y = 0.16, size = 2.2)
plot_presentD <- ggplot(present_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 32\nNo. per m2 = 13.8",
x = 18, y = 0.16, size = 2.2)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentA, plot_presentB, plot_presentC, plot_presentD,
cols = 1)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentA, plot_presentB, plot_presentC, plot_presentD,
cols = 2)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentD, plot_presentC, plot_presentB, plot_presentA,
cols = 2)
pdf("./figs/sbs_fig2.pdf", 7, 7)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentD, plot_presentC, plot_presentB, plot_presentA,
cols = 2)
dev.off()
dens_stats
# present
plot_presentA <- ggplot(present_A,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "2.7m\n1947\nn = 375\nNo. per m2 = 20 +- 22.1",
x = 18, y = 0.16, size = 2.2)
plot_presentB <- ggplot(present_B,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "3.8m\n1947\nn = 114\nNo. per m2 = 20 +- 21.2",
x = 18, y = 0.16, size = 2.2)
plot_presentC <- ggplot(present_C,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "5.9m\n1947\nn = 194\nNo. per m2 = 54 +- 75.8",
x = 18, y = 0.16, size = 2.2)
plot_presentD <- ggplot(present_D,  aes(x = size1mm)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 1,
color = "black", fill = "gray") +
scale_x_continuous(limits = c(1, 21)) +
scale_y_continuous(limits = c(0, 0.33)) +
labs(title = "A") + ULClabel + xlab("Size (mm)") + ylab("Frequency (%)") +
annotate("text", label = "7.3m\n1947\nn = 50\nNo. per m2 = 21.5",
x = 18, y = 0.16, size = 2.2)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentD, plot_presentC, plot_presentB, plot_presentA,
cols = 2)
# save as 7 x 3.5 pdf
pdf("./figs/sbs_fig2.pdf", 7, 7)
multiplot(plot_pastD, plot_pastC, plot_pastB, plot_pastA,
plot_presentD, plot_presentC, plot_presentB, plot_presentA,
cols = 2)
dev.off()
setwd("~/Desktop/currentResearch/1_biodiversityChange/lterSBC_project/divChangeHMM/R")
library(ggplot2)
theme_set(theme_bw(base_size = 12))
library(dplyr)
options(dplyr.print_max = 1e9)
# Load daily temperature data
dat<- read.csv("../data/sbc_temp_summary_daily.csv")
names(dat)
# get dates in R format
dat$dateR <- as.Date(with(dat, paste(Year, Month, Day, sep = "-")))
glimpse(dat)
# quick plot
qplot(dateR, mean_temp_c, data = dat, facets = ~site, geom = "line",
xlab = "Year", ylab = "Temperature (C)")
ggsave("../figs/dailyTemp_bySite.pdf")
# Shoot, the drop in fish richness/diversity is from 2002 to 2003
# But the temperature data start in 2002, so we dont' have
# a good sense of before-after
# Need to find temperature data that starts in 2001, at least.
datSub <- dat %>% filter(site == "ABUR" |
site == "AQUE" |
site == "CARP" |
site == "IVEE" |
site == "MOHK" |
site == "NAPL")
qplot(dateR, mean_temp_c, data = datSub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Temperature (C)")
qplot(dateR, mean_temp_c, data = datSub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Temperature (C)", color = site)
dat<- read.csv("../data/sbc_temp_summary_monthly.csv")
names(dat)
dat2 <- read.csv("../data/sbc_temp_summary_monthly.csv")
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, Day, sep = "-")))
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, sep = "-")))
names(dat2)
head(dat2)
dat$dateR <- as.Date(with(dat, paste(Year, Month, Day, sep = "-")))
glimpse(dat)
dat<- read.csv("../data/sbc_temp_summary_daily.csv")
names(dat)
# get dates in R format
dat$dateR <- as.Date(with(dat, paste(Year, Month, Day, sep = "-")))
glimpse(dat)
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, sep = "-")))
glimpse(dat2)
dat2 <- read.csv("../data/sbc_temp_summary_monthly.csv")
head(dat2)
# get dates in R format
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, sep = "-")))
glimpse(dat2)
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, sep = "-")))
glimpse(dat2)
?as.Date
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, sep = "-")), "%Y-%m")
glimpse(dat2)
dat2$yrMonth <- with(dat2, paste(Year, Month, sep = "-")))
dat2$yrMonth <- with(dat2, paste(Year, Month, sep = "-"))
glimpse(dat2)
dat2$dateR <- as.Date(with(dat2, paste(Year, Month, 15, sep = "-")))
glimpse(dat2)
dat2Sub <- dat2 %>% filter(site == "ABUR" |
site == "AQUE" |
site == "CARP" |
site == "IVEE" |
site == "MOHK" |
site == "NAPL")
qplot(dateR, mean_temp_c, data = dat2Sub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Temperature (C)", color = site)
ggsave("../figs/monthlyTemp_bySiteSub.pdf")
qplot(dateR, mean_temp_c, data = dat2Sub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Temperature (C)", color = site) +
theme(legend.position = "none")
ggsave("../figs/monthlyTemp_bySiteSub.pdf")
names(dat2Sub)
qplot(dateR, max_temp_c, data = dat2Sub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Max temperature (C)", color = site) +
theme(legend.position = "none")
ggsave("../figs/monthlyMaxTemp_bySiteSub.pdf")
qplot(dateR, max_temp_c, data = dat2Sub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Max temperature (C)", color = site) +
theme(legend.position = "none")
ggsave("../figs/monthlyMaxTemp_bySiteSub.pdf")
qplot(dateR, min_temp_c, data = dat2Sub, facets = ~site, geom = "line",
xlab = "Year", ylab = "Min temperature (C)", color = site) +
theme(legend.position = "none")
ggsave("../figs/monthlyMinTemp_bySiteSub.pdf")
setwd("~/Desktop/currentResearch/1_biodiversityChange/lterSBC_project/divChangeHMM/R")
library(lme4)
library(lmerTest)
#library(MCMCglmm)
######
#Load and do some relabeling on the different datasets
######
#use fishPlot for analysis
source("fishPrep.R")
temp <- read.csv("../data/sbc_temp_summary_MayToJuly.csv")
temp <- temp %>% rename(Site=site)
waves <- read.csv("../data/sbc_wave_summary_MayToJuly.csv")
waves <- waves %>% rename(Nearest.MOP=mop, Year=interval_year)
kelp <- read.csv("../data/sbc_macrocystis_annual.csv")
sites <- read.csv("../data/LTER_Sites_latlong.csv")
######
#Combine datasets
######
#join the lat/long info with temps
tempSites <- join(temp, sites)
tempWavesSites <- join(tempSites, waves)
#use lat/long to join the temp info with fish
tempWavesSites <- tempWavesSites %>%
rename(Latitude = Lat, Longitude=Long)
tempWavesKelpSites <- join(tempWavesSites, kelp)
fishWithPredictors <- join(fishPlot, tempWavesKelpSites) %>%
filter(!is.na(mean_temp_c))%>%
filter(!is.na(mean_waveheight))
source("fishPrep.R")
library(lme4)
library(lmerTest)
#library(MCMCglmm)
######
#Load and do some relabeling on the different datasets
######
#use fishPlot for analysis
source("fishPrep.R")
temp <- read.csv("../data/sbc_temp_summary_MayToJuly.csv")
temp <- temp %>% rename(Site=site)
waves <- read.csv("../data/sbc_wave_summary_MayToJuly.csv")
waves <- waves %>% rename(Nearest.MOP=mop, Year=interval_year)
kelp <- read.csv("../data/sbc_macrocystis_annual.csv")
sites <- read.csv("../data/LTER_Sites_latlong.csv")
#Combine datasets
######
#join the lat/long info with temps
tempSites <- join(temp, sites)
tempWavesSites <- join(tempSites, waves)
#use lat/long to join the temp info with fish
tempWavesSites <- tempWavesSites %>%
rename(Latitude = Lat, Longitude=Long)
tempWavesKelpSites <- join(tempWavesSites, kelp)
fishWithPredictors <- join(fishPlot, tempWavesKelpSites) %>%
filter(!is.na(mean_temp_c))%>%
filter(!is.na(mean_waveheight))
######
# Modeling attribution
######
# Model the effect of temperature, waves, and kelp
# with a temp*wave interaction as abiotic influences might both affect one
# another
tempLmer <- lmer(Aggregated_Richness ~ scale(Year, scale=F) +
mean_temp_c * mean_waveheight +
stipe_density +
(1 |Site/Transect) ,
data=fishWithPredictors)
summary(tempLmer)
library(visreg)
install.packages("visreg")
library(visreg)
visreg(tempLmer, "Year", by = "mean_temp_c", overlay = TRUE)
fishWithPredictors$yearScaled <- scale(Year, scale = F)
fishWithPredictors$yearScaled <- scale(fishWithPredictors$Year, scale = F)
tempLmer <- lmer(Aggregated_Richness ~ yearScaled +
mean_temp_c * mean_waveheight +
stipe_density +
(1 |Site/Transect) ,
data=fishWithPredictors)
summary(tempLmer)
visreg(tempLmer, "yearScaled", by = "mean_temp_c", overlay = TRUE)
visreg(tempLmer, "mean_temp_c")
summary(tempLmer)
summary(tempLmer)
visreg(tempLmer, "mean_temp_c", by = "waveheight")
visreg(tempLmer, "mean_temp_c", by = "mean_waveheight")
qplot(mean_waveheight, Aggregated_Richness, group=paste(Site, Transect),
data=fishWithPredictors, size=mean_temp_c) +
facet_wrap(~Site) +
stat_smooth(method="lm", fill=NA, color="red", size=1)
visreg(tempLmer, "mean_temp_c", by = "mean_waveheight")
visreg(tempLmer, "mean_temp_c", by = "mean_waveheight", overlay = TRUE)
ggsave('temp-wave-intx.pdf')
