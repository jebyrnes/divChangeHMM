summarise(nYearsSampled = n()) %>%
ungroup() %>%
filter(nYearsSampled==max(nYearsSampled))
head(fishSamples)
fishSamples$SampleID <- 1:nrow(fishSamples)
names(datW4)
fish <- inner_join(datW4, fishSamples)
dim(fish)
nplots <- length(unique(paste(fish$SITE, fish$TRANSECT)))
nplots
qplot(YEAR, rich, data = fish, color = as.factor(TRANSECT),
facets = ~SITE, geom = "line")
######################################################
# TRANSECT SCALE ANALYSIS
lmeDat <- fish
# center year on 2007
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
unique(lmeDat$YEARZ)
# using the centered year doesn't improve the
# correlation between slope and int
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | SITE
rand3 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
transect_YEARZ <- summary(fm1)$tTable[2,]
no_legend <- theme(legend.position = "none")
pTransects <- qplot(YEAR, rich, data = lmeDat, color = as.factor(st),
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
######################################################
# SITE ANALYSIS
alphaDF <- fish %>% rename(site = SITE, year = YEAR, transect = TRANSECT)
### Calculate sums per site, to get gamma scale metrics
names(alphaDF)
sdF <- function(x) return(as.factor(paste(x$site, x$year, sep="_")))
alphaDF$sd <- sdF(alphaDF)
# Create a uniform data frame
temp0 <- alphaDF # MODIFY
temp1 <- temp0[, 4:58] # MODIFY!
temp2 <- select(temp0, site, year, sd)
temp3 <- cbind(temp1, temp2)
head(temp3)
dim(temp3)
# Gamma - rich, div, even, abund
gammaDF <- temp3 %>% group_by(year, site, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gammaDF)
gammaDF <- divMetF(gammaDF, 4, dim(gammaDF)[2])
gammaDF$rich
# Regional - rich, div, even, abund
regDF <- temp3 %>% group_by(year) %>%
summarise_each(funs(sum)) %>% ungroup()
head(regDF)
regDF <- divMetF(regDF, 4, dim(regDF)[2])
names(alphaDF)
names(gammaDF)
##########################################
# Mixed model for gammaDF
summary(gammaDF$year)
gammaDF$yearZ <- gammaDF$year - 2007
summary(gammaDF)
rand1 <- yearZ | site
fm2 <- lme(fixed = rich ~ yearZ,
data = gammaDF, method = "ML",
random =  list(~ 1 | site),
correlation = corAR1())
summary(fm2)$tTable
site_YEARZ <- summary(fm2)$tTable[2,]
##########################################
##########################################
# Linear model for regDF
summary(regDF$year)
regDF$yearZ <- regDF$year - 2007
summary(regDF)
rand1 <- yearZ | site
# need a dummy variable
regDF$dummy <- rep(1, dim(regDF)[1])
fm3 <- lme(fixed = rich ~ yearZ,
data = regDF, method = "ML",
random = ~ 1|dummy,
correlation = corAR1())
summary(fm3)$tTable[2,]
region_YEARZ <- summary(fm3)$tTable[2,]
##########################################
# bind the slope and se's
scale_yearZ <- as.data.frame(rbind(transect_YEARZ, site_YEARZ, region_YEARZ))
scale_yearZ
scale_yearZ$scale <- c("Transect", "Site", "Regional")
# relevel
scale_yearZ$scale <- factor(scale_yearZ$scale, levels = c("Transect", "Site", "Regional"))
scale_trend <- ggplot(scale_yearZ,
mapping=aes(x = scale, y = Value,
ymin = Value - 2*Std.Error, ymax = Value + 2*Std.Error)) +
geom_point(size=5) +
geom_linerange(size=1.2) +
ylab("Temporal trend in richness\n(change in # of species/year)\n") +
xlab("Scale")
scale_trend
ggsave("./figs/scale_trend.pdf", width = 7, height = 7)
##########################################
pSites <- qplot(year, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "point") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects <- ggplot(data = alphaDF,
aes(year, rich, group = as.factor(transect))) +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale") +
xlab("Year") + ylab("S")
pTransects
pRegion <- qplot(year, rich, data = regDF,
xlab = "Year", ylab = "S", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
# save multiplot as 8x8 figure
multiplot(pTransects, pSites, pRegion, scale_trend,
layout = matrix(c(1,1,2,3,4,4), nrow = 3, byrow = TRUE))
theme_set(theme_bw(base_size=12))
theme_set(theme_bw(base_size=12))
# TRANSECT SCALE ANALYSIS
lmeDat <- fish
# center year on 2007
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
unique(lmeDat$YEARZ)
# using the centered year doesn't improve the
# correlation between slope and int
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | SITE
rand3 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
transect_YEARZ <- summary(fm1)$tTable[2,]
no_legend <- theme(legend.position = "none")
pTransects <- qplot(YEAR, rich, data = lmeDat, color = as.factor(st),
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
######################################################
# SITE ANALYSIS
alphaDF <- fish %>% rename(site = SITE, year = YEAR, transect = TRANSECT)
### Calculate sums per site, to get gamma scale metrics
names(alphaDF)
sdF <- function(x) return(as.factor(paste(x$site, x$year, sep="_")))
alphaDF$sd <- sdF(alphaDF)
# Create a uniform data frame
temp0 <- alphaDF # MODIFY
temp1 <- temp0[, 4:58] # MODIFY!
temp2 <- select(temp0, site, year, sd)
temp3 <- cbind(temp1, temp2)
head(temp3)
dim(temp3)
# Gamma - rich, div, even, abund
gammaDF <- temp3 %>% group_by(year, site, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gammaDF)
gammaDF <- divMetF(gammaDF, 4, dim(gammaDF)[2])
gammaDF$rich
# Regional - rich, div, even, abund
regDF <- temp3 %>% group_by(year) %>%
summarise_each(funs(sum)) %>% ungroup()
head(regDF)
regDF <- divMetF(regDF, 4, dim(regDF)[2])
names(alphaDF)
names(gammaDF)
##########################################
# Mixed model for gammaDF
summary(gammaDF$year)
gammaDF$yearZ <- gammaDF$year - 2007
summary(gammaDF)
rand1 <- yearZ | site
fm2 <- lme(fixed = rich ~ yearZ,
data = gammaDF, method = "ML",
random =  list(~ 1 | site),
correlation = corAR1())
summary(fm2)$tTable
site_YEARZ <- summary(fm2)$tTable[2,]
##########################################
##########################################
# Linear model for regDF
summary(regDF$year)
regDF$yearZ <- regDF$year - 2007
summary(regDF)
rand1 <- yearZ | site
# need a dummy variable
regDF$dummy <- rep(1, dim(regDF)[1])
fm3 <- lme(fixed = rich ~ yearZ,
data = regDF, method = "ML",
random = ~ 1|dummy,
correlation = corAR1())
summary(fm3)$tTable[2,]
region_YEARZ <- summary(fm3)$tTable[2,]
##########################################
# bind the slope and se's
scale_yearZ <- as.data.frame(rbind(transect_YEARZ, site_YEARZ, region_YEARZ))
scale_yearZ
scale_yearZ$scale <- c("Transect", "Site", "Regional")
# relevel
scale_yearZ$scale <- factor(scale_yearZ$scale, levels = c("Transect", "Site", "Regional"))
scale_trend <- ggplot(scale_yearZ,
mapping=aes(x = scale, y = Value,
ymin = Value - 2*Std.Error, ymax = Value + 2*Std.Error)) +
geom_point(size=5) +
geom_linerange(size=1.2) +
ylab("Temporal trend in richness\n(change in # of species/year)\n") +
xlab("Scale")
scale_trend
ggsave("./figs/scale_trend.pdf", width = 7, height = 7)
##########################################
pSites <- qplot(year, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "point") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects <- ggplot(data = alphaDF,
aes(year, rich, group = as.factor(transect))) +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale") +
xlab("Year") + ylab("S")
pTransects
pRegion <- qplot(year, rich, data = regDF,
xlab = "Year", ylab = "S", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
multiplot(pTransects, pSites, pRegion, scale_trend,
layout = matrix(c(1,1,2,3,4,4), nrow = 3, byrow = TRUE))
lmeDat <- filter(datW4, SITE != "AHND" & SITE != "GOLB")
lmeDat <- datW4
# Include transects with data from 2001-2014
fishSamples <- datW4 %>% group_by(SITE, TRANSECT, YEAR) %>%
summarise(n = n()) %>% ungroup() %>%  #reduce the dataset down to one line per site*year
group_by(SITE, TRANSECT) %>%
summarise(nYearsSampled = n()) %>%
ungroup() %>%
filter(nYearsSampled==max(nYearsSampled))
head(fishSamples)
fishSamples$SampleID <- 1:nrow(fishSamples)
names(datW4)
fish <- inner_join(datW4, fishSamples)
dim(fish)
nplots <- length(unique(paste(fish$SITE, fish$TRANSECT)))
nplots
qplot(YEAR, rich, data = fish, color = as.factor(TRANSECT),
facets = ~SITE, geom = "line")
######################################################
# TRANSECT SCALE ANALYSIS
lmeDat <- fish
# center year on 2007
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
unique(lmeDat$YEARZ)
# using the centered year doesn't improve the
# correlation between slope and int
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | SITE
rand3 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
transect_YEARZ <- summary(fm1)$tTable[2,]
no_legend <- theme(legend.position = "none")
pTransects <- qplot(YEAR, rich, data = lmeDat, color = as.factor(st),
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
######################################################
# SITE ANALYSIS
alphaDF <- fish %>% rename(site = SITE, year = YEAR, transect = TRANSECT)
### Calculate sums per site, to get gamma scale metrics
names(alphaDF)
sdF <- function(x) return(as.factor(paste(x$site, x$year, sep="_")))
alphaDF$sd <- sdF(alphaDF)
# Create a uniform data frame
temp0 <- alphaDF # MODIFY
temp1 <- temp0[, 4:58] # MODIFY!
temp2 <- select(temp0, site, year, sd)
temp3 <- cbind(temp1, temp2)
head(temp3)
dim(temp3)
# Gamma - rich, div, even, abund
gammaDF <- temp3 %>% group_by(year, site, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gammaDF)
gammaDF <- divMetF(gammaDF, 4, dim(gammaDF)[2])
gammaDF$rich
# Regional - rich, div, even, abund
regDF <- temp3 %>% group_by(year) %>%
summarise_each(funs(sum)) %>% ungroup()
head(regDF)
regDF <- divMetF(regDF, 4, dim(regDF)[2])
names(alphaDF)
names(gammaDF)
##########################################
# Mixed model for gammaDF
summary(gammaDF$year)
gammaDF$yearZ <- gammaDF$year - 2007
summary(gammaDF)
rand1 <- yearZ | site
fm2 <- lme(fixed = rich ~ yearZ,
data = gammaDF, method = "ML",
random =  list(~ 1 | site),
correlation = corAR1())
summary(fm2)$tTable
summary(gammaDF$year)
gammaDF$yearZ <- gammaDF$year - 2007
summary(gammaDF)
rand1 <- yearZ | site
fm2 <- lme(fixed = rich ~ yearZ,
data = gammaDF, method = "ML",
random =  list(~ 1 | site),
correlation = corAR1())
summary(fm2)$tTable
site_YEARZ <- summary(fm2)$tTable[2,]
summary(regDF$year)
regDF$yearZ <- regDF$year - 2007
summary(regDF)
# need a dummy variable
regDF$dummy <- rep(1, dim(regDF)[1])
fm3 <- lme(fixed = rich ~ yearZ,
data = regDF, method = "ML",
random = ~ 1|dummy,
correlation = corAR1())
summary(fm3)$tTable[2,]
region_YEARZ <- summary(fm3)$tTable[2,]
##########################################
# bind the slope and se's
scale_yearZ <- as.data.frame(rbind(transect_YEARZ, site_YEARZ, region_YEARZ))
scale_yearZ
scale_yearZ <- as.data.frame(rbind(transect_YEARZ, site_YEARZ, region_YEARZ))
region_YEARZ <- summary(fm3)$tTable[2,]
site_YEARZ <- summary(fm2)$tTable[2,]
transect_YEARZ <- summary(fm1)$tTable[2,]
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | SITE
rand3 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
unique(lmeDat$YEARZ)
# using the centered year doesn't improve the
# correlation between slope and int
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | SITE
rand3 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
unique(lmeDat$YEARZ)
# using the centered year doesn't improve the
# correlation between slope and int
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | SITE
rand3 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand3),
correlation = corAR1())
transect_YEARZ <- summary(fm1)$tTable[2,]
summary(fm1)$tTable
no_legend <- theme(legend.position = "none")
pTransects <- qplot(YEAR, rich, data = lmeDat, color = as.factor(st),
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
######################################################
# SITE ANALYSIS
alphaDF <- fish %>% rename(site = SITE, year = YEAR, transect = TRANSECT)
### Calculate sums per site, to get gamma scale metrics
names(alphaDF)
sdF <- function(x) return(as.factor(paste(x$site, x$year, sep="_")))
alphaDF$sd <- sdF(alphaDF)
# Create a uniform data frame
temp0 <- alphaDF # MODIFY
temp1 <- temp0[, 4:58] # MODIFY!
temp2 <- select(temp0, site, year, sd)
temp3 <- cbind(temp1, temp2)
head(temp3)
dim(temp3)
# Gamma - rich, div, even, abund
gammaDF <- temp3 %>% group_by(year, site, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gammaDF)
gammaDF <- divMetF(gammaDF, 4, dim(gammaDF)[2])
gammaDF$rich
# Regional - rich, div, even, abund
regDF <- temp3 %>% group_by(year) %>%
summarise_each(funs(sum)) %>% ungroup()
head(regDF)
regDF <- divMetF(regDF, 4, dim(regDF)[2])
names(alphaDF)
names(gammaDF)
##########################################
# Mixed model for gammaDF
summary(gammaDF$year)
gammaDF$yearZ <- gammaDF$year - 2007
summary(gammaDF)
gammaDF
fm2 <- lme(fixed = rich ~ yearZ,
data = gammaDF, method = "ML",
random =  list(~ yearZ | site),
correlation = corAR1())
fm2 <- lme(fixed = rich ~ yearZ,
data = gammaDF, method = "ML",
random =  list(~ 1 | site),
correlation = corAR1())
summary(fm2)$tTable
site_YEARZ <- summary(fm2)$tTable[2,]
summary(regDF$year)
regDF$yearZ <- regDF$year - 2007
summary(regDF)
# need a dummy variable
regDF$dummy <- rep(1, dim(regDF)[1])
fm3 <- lme(fixed = rich ~ yearZ,
data = regDF, method = "ML",
random = ~ 1|dummy,
correlation = corAR1())
summary(fm3)$tTable[2,]
scale_yearZ <- as.data.frame(rbind(transect_YEARZ, site_YEARZ, region_YEARZ))
scale_yearZ
scale_yearZ$scale <- c("Transect", "Site", "Regional")
# relevel
scale_yearZ$scale <- factor(scale_yearZ$scale, levels = c("Transect", "Site", "Regional"))
scale_trend <- ggplot(scale_yearZ,
mapping=aes(x = scale, y = Value,
ymin = Value - 2*Std.Error, ymax = Value + 2*Std.Error)) +
geom_point(size=5) +
geom_linerange(size=1.2) +
ylab("Temporal trend in richness\n(change in # of species/year)\n") +
xlab("Scale")
scale_trend
scale_trend <- ggplot(scale_yearZ,
mapping=aes(x = scale, y = Value,
ymin = Value - 2*Std.Error, ymax = Value + 2*Std.Error)) +
geom_point(size=5) +
geom_linerange(size=1.2) +
ylab("Temporal trend in richness\n(change in # of species/year)\n") +
xlab("Scale") +
geom_abline(a = 0, b = 0, type = 'dashed')
scale_trend
geom_hline(a = 0, type = 'dashed')
scale_trend <- ggplot(scale_yearZ,
mapping=aes(x = scale, y = Value,
ymin = Value - 2*Std.Error, ymax = Value + 2*Std.Error)) +
geom_point(size=5) +
geom_linerange(size=1.2) +
ylab("Temporal trend in richness\n(change in # of species/year)\n") +
xlab("Scale") +
geom_hline(a = 0, type = 'dashed')
scale_trend
scale_trend <- ggplot(scale_yearZ,
mapping=aes(x = scale, y = Value,
ymin = Value - 2*Std.Error, ymax = Value + 2*Std.Error)) +
geom_point(size = 4) +
geom_linerange(size = 1) +
ylab("Temporal trend in richness\n(change in # of species/year)\n") +
xlab("Scale") +
geom_hline(a = 0, linetype = 'dashed')
scale_trend
ggsave("./figs/scale_trend.pdf", width = 5, height = 5)
pSites <- qplot(year, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "point") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects <- ggplot(data = alphaDF,
aes(year, rich, group = as.factor(transect))) +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale") +
xlab("Year") + ylab("S")
pTransects
pRegion <- qplot(year, rich, data = regDF,
xlab = "Year", ylab = "S", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
# save multiplot as 8x8 figure
multiplot(pTransects, pSites, pRegion, scale_trend,
layout = matrix(c(1,1,2,3,4,4), nrow = 3, byrow = TRUE))
