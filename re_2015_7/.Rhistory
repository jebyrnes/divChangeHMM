with(datW, table(st, YEAR))
# go from long to wide
datL <- dat9
# rename columns to match
datL <- rename(datL, YEAR = year, SITE = site, TRANSECT = transect)
names(datL)
datW <- dcast(datL, YEAR + SITE + TRANSECT ~ genSp,
value.var = "Abundance")
names(datW)
summary(datW)
datW <- datW[with(datW, order(SITE, TRANSECT, YEAR)), ]
# remove NO FISH column
datW <- datW[, -33]
names(datW)
datW <- divMetF(datW, 4, 58)
# check for duplicates
styF <- function(x) return(as.factor(paste(x$SITE, x$TRANSECT, x$YEAR, sep="_")))
datW$sty <- styF(datW)
which(duplicated(datW$sty))
stF <- function(x) return(as.factor(paste(x$SITE, x$TRANSECT, sep="_")))
datW$st <- stF(datW)
# remove year 2000
datW <- filter(datW, YEAR > 2000)
# which site year combinations need to be removed so that I can calculate gamma div?
with(datW, table(st, YEAR))
fishDatW <- datW
head(datW)
write.csv(fishDatW, "fishDatW.csv")
summary(datW)
# which site year combinations need to be removed so that I can calculate gamma div?
with(datW, table(st, YEAR))
head(datW)
unique(datW$st)
datW2 <- droplevels(filter(datW,
st != "AQUE_6" &
st != "BULL_2" &
st != "BULL_4" &
st != "BULL_5" &
st != "BULL_7" &
st != "BULL_8" &
st != "CARP_2" &
st != "CARP_4" &
st != "CARP_8" &
st != "IVEE_3" &
st != "IVEE_4" &
st != "IVEE_5" &
st != "IVEE_6" &
st != "IVEE_7" &
st != "IVEE_8" &
st != "SCDI_1"))
with(datW2, table(st, YEAR))
# select good ahnd, golb, bull
ahnd <- droplevels(filter(datW2, SITE == "AHND" &
YEAR > 2006))
golb <- droplevels(filter(datW2, SITE == "GOLB" &
YEAR > 2005))
bull <- droplevels(filter(datW2, SITE == "BULL" &
YEAR < 2011))
# remove ahdn, golb, bull
datW3 <- filter(datW2, SITE != "AHND" &
SITE != "GOLB" &
SITE != "BULL")
datW4 <- rbind(datW3, ahnd, golb, bull)
dim(with(datW4, table(st, YEAR)))
with(datW4, table(st, YEAR))
qplot(YEAR, rich, datW4, color = TRANSECT, facets = ~SITE)
names(datW4)
qplot(YEAR, rich, datW4, color = TRANSECT, facets = ~ SITE)
qplot(YEAR, rich, datW4, color = TRANSECT, facets = ~SITE)
?qplot
qplot(YEAR, rich, datW4, color = TRANSECT)
names(datW4)
qplot(YEAR, rich, data = datW4, color = TRANSECT, facets = ~SITE)
theme_set(theme_bw(base_size=17))
qplot(YEAR, rich, data = datW4, color = as.factor(TRANSECT),
facets = ~SITE, geom = "line")
rand1 <- 1 | SITE
rand2 <- YEAR | TRANSECT
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | TRANSECT
rand1 <- ~ YEAR | SITE
rand2 <- ~ YEAR | TRANSECT
lmeDat <- datW4
rand1 <- ~ YEAR | SITE
rand2 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "REML",
random =  list(rand1, rand2)
correlation = corAR1())
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
library(lme)
library(nlme)
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
plot(fm1)
unique(lmeDat$YEAR)
# center year on 2007
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
rand2 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
plot(fm1)
fm1 <- lme(fixed = rich ~ YEARZ + abund,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
unique(lmeDat$YEAR)
str(lmeDat)
lmeDat$YEARZ <- lmeDat$YEAR - 2000
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
qplot(YEAR, rich, data = datW4, color = as.factor(TRANSECT),
facets = ~SITE, geom = "line")
lmeDat <- filter(SITE != "AHND" & SITE != "GOLB")
lmeDat <- filter(datW4, SITE != "AHND" & SITE != "GOLB")
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEARZ | TRANSECT
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "REML",
random =  list(rand1, rand2),
correlation = corAR1())
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand1, rand2),
correlation = corAR1())
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "ML",
random =  list(rand1, rand2),
correlation = corAR1())
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "ML",
random =  list(rand1, rand2),
correlation = corAR1())
summary(fm1)
acf(fm1)
lmeDat <- datW4
# center year on 2007
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
str(lmeDat)
# rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | SITE
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand2)
correlation = corAR1())
summary(fm1)
rand2 <- ~ YEAR | SITE
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand2)
correlation = corAR1())
summary(fm1)
plot(fm1)
rand2 <- ~ YEARZ | SITE
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand2)
correlation = corAR1())
fm1 <- lme(fixed = rich ~ YEARZ,
data = lmeDat, method = "ML",
random =  list(rand2),
correlation = corAR1())
summary(fm1)
rand2 <- ~ YEAR | SITE
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "ML",
random =  list(rand2),
correlation = corAR1())
summary(fm1)
rand1 <- ~ 1 | SITE
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | SITE
rand3 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
summary(fm1)
qplot(YEAR, rich, data = datW4, color = as.factor(TRANSECT), geom = "line")
str(lmeDat)
qplot(YEAR, rich, data = datW4, color = as.factor(st), geom = "line")
no_legend <- theme(legend.position = "none")
qplot(YEAR, rich, data = datW4, color = as.factor(st), geom = "line",
xlab = "Year", ylab = "S") + no_legend + ggtitle("Transect-scale")
datW4 %>% group_by(SITE, TRANSECT, YEAR) %>%
summarise(n = n())
datW4 %>% group_by(SITE, TRANSECT, YEAR) %>%
summarise(n = n()) %>% ungroup()
datW4 %>% group_by(SITE, TRANSECT, YEAR) %>%
summarise(n = n()) %>% ungroup() %>%  #reduce the dataset down to one line per site*year
group_by(SITE, TRANSECT) %>%
summarise(nYearsSampled = n())
datW4 %>% group_by(SITE, TRANSECT, YEAR) %>%
summarise(n = n()) %>% ungroup() %>%  #reduce the dataset down to one line per site*year
group_by(SITE, TRANSECT) %>%
summarise(nYearsSampled = n()) %>%
ungroup() %>%
filter(nYearsSampled==max(nYearsSampled))
fishSamples <- datW4 %>% group_by(SITE, TRANSECT, YEAR) %>%
summarise(n = n()) %>% ungroup() %>%  #reduce the dataset down to one line per site*year
group_by(SITE, TRANSECT) %>%
summarise(nYearsSampled = n()) %>%
ungroup() %>%
filter(nYearsSampled==max(nYearsSampled))
fishSamples
fishSamples$SampleID <- 1:nrow(fishSamples)
head(fishSamples)
dim(datW4)
names(datW4)
fish <- inner_join(datW4, fishSamples)
dim(fish)
nplots <- length(unique(paste(fish$SITE, fish$TRANSECT)))
nplots
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | SITE
rand3 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
summary(fm1)
plot(fm1)
no_legend <- theme(legend.position = "none")
qplot(YEAR, rich, data = datW4, color = as.factor(st), geom = "line",
xlab = "Year", ylab = "S") + no_legend + ggtitle("Transect-scale")
lmeDat <- fish
on 2007
unique(lmeDat$YEAR)
lmeDat$YEARZ <- lmeDat$YEAR - 2007
# using the centered year doesn't improve the
# correlation between slope and int
str(lmeDat)
rand1 <- ~ 1 | SITE
rand2 <- ~ YEAR | SITE
rand3 <- ~ YEAR | TRANSECT
fm1 <- lme(fixed = rich ~ YEAR,
data = lmeDat, method = "ML",
random =  list(rand1, rand3),
correlation = corAR1())
summary(fm1)
plot(fm1)
no_legend <- theme(legend.position = "none")
qplot(YEAR, rich, data = datW4, color = as.factor(st), geom = "line",
xlab = "Year", ylab = "S") + no_legend + ggtitle("Transect scale")
qplot(YEAR, rich, data = lmeDat, color = as.factor(st), geom = "line",
xlab = "Year", ylab = "S") + no_legend + ggtitle("Transect scale")
pTransects <- qplot(YEAR, rich, data = lmeDat, color = as.factor(st), geom = "line",
xlab = "Year", ylab = "S") + no_legend + ggtitle("Transect scale")
qplot(YEAR, rich, data = fish, color = as.factor(TRANSECT),
facets = ~SITE, geom = "line")
names(fish)
sdF <- function(x) return(as.factor(paste(x$SITE, x$YEAR, sep="_")))
sdF <- function(x) return(as.factor(paste(x$SITE, x$YEAR, sep="_")))
fish$sd <- sdF(fish)
names(fish)
alphaDF <- fish
alphaDF <- fish
alphaDF <- fish %>% rename(site = SITE, year = YEAR)
names(alphaDF)
alphaDF <- fish %>% rename(site = SITE, year = YEAR, transect = TRANSECT)
names(alphaDF)
sdF <- function(x) return(as.factor(paste(x$site, x$year, sep="_")))
fish$sd <- sdF(fish)
temp0 <- alphaDF # MODIFY
alphaDF$sd <- sdF(alphaDF)
names(alphaDF)
temp0 <- alphaDF # MODIFY
temp1 <- temp0[, 4:58] # MODIFY!
temp2 <- select(temp0, site, year, sd)
temp3 <- cbind(temp1, temp2)
head(temp3)
dim(temp3)
gamDF <- temp3 %>% group_by(site, year, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gamDF)
gamDF <- divMetF(gamDF, 4, dim(gamDF)[2])
gamDF$rich
gammaDF <- temp3 %>% group_by(site, year, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gammaDF)
head(alphaDF)
names(DF)
names(alphaDF)
names(gammaDF)
gammaDF <- divMetF(gammaDF, 4, dim(gammaDF)[2])
gammaDF$rich
names(alphaDF)
names(gammaDF)
gammaDF <- temp3 %>% group_by(year, site, sd) %>%
summarise_each(funs(sum)) %>% ungroup()
head(gammaDF)
# Gamma - rich, div, even, abund
gammaDF <- divMetF(gammaDF, 4, dim(gammaDF)[2])
gammaDF$rich
names(alphaDF)
names(gammaDF)
pSites <- qplot(YEAR, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
pSites
pSites <- qplot(year, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
pSites
pTransects <- qplot(year, rich, data = alphaDF, color = as.factor(st),
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
pTransects
pSites <- qplot(year, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, rich, data = alphaDF, color = site,
facets = ~site, geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(TRANSECT),
facets = ~site, geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S") +
geom_line(color = site) +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- ggplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "none") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- ggplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "none")
pTransects <- ggplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "none")
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "none") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects
pTransects
pSites <- qplot(year, rich, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "S") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, rich, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "point") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects
pSites
regDF <- temp3 %>% group_by(year) %>%
summarise_each(funs(sum)) %>% ungroup()
head(regDF)
regDF <- divMetF(regDF, 4, dim(regDF)[2])
pRegion <- qplot(year, rich, data = regDF,
xlab = "Year", ylab = "S") +
no_legend + ggtitle("Regional scale")
pRegion
pRegion <- qplot(year, rich, data = regDF,
xlab = "Year", ylab = "S", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
source("./R/multiplotF.R")
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
pTransects <- ggplot(data = alphaDF, aes(year, rich,
group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "S", geom = "line") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- ggplot(data = alphaDF,
aes(year, rich, group = as.factor(transect)),
facets = ~site, xlab = "Year", ylab = "S", geom = "line") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects
pTransects <- ggplot(data = alphaDF,
aes(year, rich, group = as.factor(transect)),
xlab = "Year", ylab = "S", geom = "line") +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale")
pTransects
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
pTransects <- ggplot(data = alphaDF,
aes(year, rich, group = as.factor(transect))) +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale") +
xlab("Year") + ylab("S")
pTransects
pRegion <- qplot(year, rich, data = regDF,
xlab = "Year", ylab = "S", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
?ggsave
ggsave("./figs/fishScale.pdf")
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
pSites <- qplot(year, div, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "H'") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, div, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "H'", geom = "point") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects <- ggplot(data = alphaDF,
aes(year, div, group = as.factor(transect))) +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale") +
xlab("Year") + ylab("H'")
pTransects
pRegion <- qplot(year, div, data = regDF,
xlab = "Year", ylab = "H'", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
# save multiplot as 8x8 figure
summary(alphaDF$even)
summary(alphaDF$div)
pSites <- qplot(year, even, data = gammaDF, color = site,
geom = "line", xlab = "Year", ylab = "J") +
no_legend + ggtitle("Site scale")
pSites
pTransects <- qplot(year, even, data = alphaDF, group = as.factor(transect),
facets = ~site, xlab = "Year", ylab = "J", geom = "point") +
geom_line(aes(color = site)) +
no_legend + ggtitle("Transect scale")
pTransects <- ggplot(data = alphaDF,
aes(year, even, group = as.factor(transect))) +
geom_line(aes(color = site)) + facet_wrap(~ site) +
no_legend + ggtitle("Transect scale") +
xlab("Year") + ylab("J")
pTransects
pRegion <- qplot(year, even, data = regDF,
xlab = "Year", ylab = "J", geom = "line") +
no_legend + ggtitle("Regional scale")
pRegion
multiplot(pTransects, pSites, pRegion, layout = matrix(c(1,1,2,3),
nrow = 2, byrow = TRUE))
# save multiplot as 8x8 figure
